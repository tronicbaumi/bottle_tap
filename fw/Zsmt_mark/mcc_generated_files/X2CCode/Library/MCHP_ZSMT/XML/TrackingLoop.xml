<?xml version="1.0" encoding="utf-8"?><!--V.0.29--><ControlBlock BlockId="4021" BlockName="TrackingLoop" LibraryName="MCHP_ZSMT" Author="rkothbauer" Revision="0.1" DateCreated="2021-12-07" DateLastChange="2023-08-10" Prompt="TrackingLoop" Order="0" SampleTimeFactor="1" TexFile="" LibraryType="INTERNAL" PreNameSpace="at.lcm.x2c" DefaultImplementation="FiP16" DirectFeedThrough="true" ParameterId="0" IsStaticId="false" IsConversionOnTarget="false" TaskLabel=""><BlockLicense Type="None"><CopyrightStatement></CopyrightStatement><LicenseStatement></LicenseStatement><Header>This file is part of X2C. http://x2c.lcm.at/
$LastChangedRevision: 1603 $
$LastChangedDate:: 2019-01-21 19:02:13 +0100#$</Header></BlockLicense><Description>Calculates rotor angle and speed based on angle-error response due to voltage injection

BE AWARE:
For using this block with HFInjSquare-Block, set the sample time factor to 4 times the sample time factor of HFInjSquare-Block.</Description><Mask Name="Mask"><InportContainer><MaskInport Name="phi_eps"><Description>rotor angle estimation error</Description><ConnectedOutport Name=""><BlockLink Name=""></BlockLink></ConnectedOutport></MaskInport><MaskInport Name="n0"><Description>Initial speed preloaded at rising edge of Enable signal</Description><ConnectedOutport Name=""><BlockLink Name=""></BlockLink></ConnectedOutport></MaskInport><MaskInport Name="phi0"><Description>Initial rotor angle preloaded at rising edge of Enable signal</Description><ConnectedOutport Name=""><BlockLink Name=""></BlockLink></ConnectedOutport></MaskInport><MaskInport Name="Enable"><Description>Enable == 0: Deactivation of this block; Outputs are set to zero
Enable 0-&gt;1: Preload of angle and speed for internal integrators
Enable == 1: Activation of this block</Description><ConnectedOutport Name=""><BlockLink Name=""></BlockLink></ConnectedOutport></MaskInport></InportContainer><OutportContainer><MaskOutport Name="n"><Description>Angular speed</Description></MaskOutport><MaskOutport Name="phi"><Description>Estimated electrical rotor angle</Description></MaskOutport></OutportContainer><ParameterContainer><MaskParameter Name="Jp" Prompt="Moment of inertia [kg*m^2]"><Description>Moment of inertia of rotor (and load)</Description><MaskDouble><Value><Numeric>0.0</Numeric></Value><DefaultValue><Numeric>0.0</Numeric></DefaultValue></MaskDouble></MaskParameter><MaskParameter Name="fo" Prompt="fo [Hz]"><Description>Frequency of observer pole. The higher the pole is chosen, the more dynamic is the angle estimation.</Description><MaskDouble><Value><Numeric>0.0</Numeric></Value><DefaultValue><Numeric>0.0</Numeric></DefaultValue></MaskDouble></MaskParameter><MaskParameter Name="p" Prompt="Motor Data: p (Number of pole pairs)"><Description>Number of pole pairs</Description><MaskDouble><Value><Numeric>1.0</Numeric></Value><DefaultValue><Numeric>1.0</Numeric></DefaultValue></MaskDouble></MaskParameter><MaskParameter Name="estimation" Prompt="Speed estimation type"><Description>Select where to place the emphasis of the speed output: dynamic or noise</Description><MaskComboBox><Value><String>less noise</String></Value><DefaultValue><String>less noise</String></DefaultValue><Content><Item><String>high dynamics</String></Item><Item><String>less noise</String></Item></Content></MaskComboBox></MaskParameter><MaskParameter Name="method" Prompt="Discretization Method"><Description>Discretization method of of used LTI systems (PI, I)</Description><MaskComboBox><Value><String>tustin</String></Value><DefaultValue><String>tustin</String></DefaultValue><Content><Item><String>zoh</String></Item><Item><String>tustin</String></Item></Content></MaskComboBox></MaskParameter><MaskParameter Name="n_max" Prompt="Scaling: n_max [rpm]"><Description>Maximum (mechanical) speed
(Only used for scaling in fixed point implementations)</Description><MaskDouble><Value><Numeric>0.0</Numeric></Value><DefaultValue><Numeric>0.0</Numeric></DefaultValue></MaskDouble></MaskParameter><MaskParameter Name="ts_fact" Prompt="Sample Time Multiplier"><Description>Multiplication factor of base sampling time (in integer format).</Description><MaskDouble><Value><Numeric>4.0</Numeric></Value><DefaultValue><Numeric>4.0</Numeric></DefaultValue></MaskDouble></MaskParameter></ParameterContainer><Visualizations><Visualization Name="ScilabXcos" Type="VisualizationScilabXcos"><ScriptDefineSection></ScriptDefineSection><ScriptPlotSection></ScriptPlotSection><ScriptStyle></ScriptStyle><BlockIconDefaultSize>[5 6]</BlockIconDefaultSize></Visualization><Visualization Name="Matlab" Type="VisualizationMatlab"><Command><Item>patch([0 1 1], [0 0 0.35], [0.91 0.84 0])</Item><Item></Item><Item>port_label('input',1,'d\phi','texmode','on')</Item><Item>port_label('input',2,'n_{0}','texmode','on')</Item><Item>port_label('input',3,'\phi_{0}','texmode','on')</Item><Item>port_label('input',4,'Enable')</Item><Item></Item><Item>port_label('output',1,'n','texmode','on')</Item><Item>port_label('output',2,'\phi','texmode','on')</Item></Command></Visualization></Visualizations></Mask><ImplementationConfig><ExistingImplementationContainer><Implementation Id="1" Name="FiP16" FriendlyName="16 Bit Fixed Point" Author="rkothbauer" Revision="1" DateCreated="2021-12-07" DateLastChange="2021-12-07" CFileName="TrackingLoop_FiP16.c" HFileName="TrackingLoop_FiP16.h" UpdateEnabled="true" ChecksumCFile="" ChecksumHFile="" AllowEmptyLoadFnc="false"><Description>16 Bit Fixed Point Implementation</Description><InportContainer><ImplementationInport Name="phi_eps" DataType="INT16"></ImplementationInport><ImplementationInport Name="n0" DataType="INT16"></ImplementationInport><ImplementationInport Name="phi0" DataType="INT16"></ImplementationInport><ImplementationInport Name="Enable" DataType="BOOL"></ImplementationInport></InportContainer><OutportContainer><ImplementationOutport Name="n" DataType="INT16"></ImplementationOutport><ImplementationOutport Name="phi" DataType="INT16"></ImplementationOutport></OutportContainer><ParameterContainer><ImplementationParameter Name="enable_old" DataType="BOOL" isLoadable="false" isSaveable="false" isArray="false" isFlashArray="false" arraySize="0"><Description>Enable value of previous cycle</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="i_old_torque" DataType="INT64" isLoadable="false" isSaveable="false" isArray="false" isFlashArray="false" arraySize="0"><Description>Torque integrator value from previous cycle</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="i_old_speed" DataType="INT64" isLoadable="false" isSaveable="false" isArray="false" isFlashArray="false" arraySize="0"><Description>Speed integrator value from previous cycle</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="i_old_angle" DataType="INT32" isLoadable="false" isSaveable="false" isArray="false" isFlashArray="false" arraySize="0"><Description>Angle integrator value from previous cycle</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="vGain" DataType="INT16" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Proportional gain value</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="sfrGain" DataType="INT8" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Shift factor of proportional gain</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="b0_torque" DataType="INT32" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Integral coefficient PI</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="b1_torque" DataType="INT32" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Proportional coefficient PI</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="sfrb0_torque" DataType="INT8" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Shift factor for PI coefficient b0</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="sfrb1_torque" DataType="INT8" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Shift factor for PI coefficient b1</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="b0_speed" DataType="INT32" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Integral coefficient PI</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="b1_speed" DataType="INT32" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Proportional coefficient PI</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="sfrb0_speed" DataType="INT8" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Shift factor for PI coefficient b0</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="sfrb1_speed" DataType="INT8" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Shift factor for PI coefficient b1</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="b0_angle" DataType="INT16" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Integral coefficient PI</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="b1_angle" DataType="INT16" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Proportional coefficient PI</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="sfrb0_angle" DataType="INT8" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Shift factor for PI coefficient b0</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="sfrb1_angle" DataType="INT8" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Shift factor for PI coefficient b1</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="rawSpeed" DataType="BOOL" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>If true, the input to the angle integrator is the signal given to Speed output
If false, the output of the speed integrator is the signal given to Speed output</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter></ParameterContainer><Conversion Type="JavaScript" Language="JavaScript"></Conversion><FunctionLink Status="false" BlockName="" ImplementationName=""></FunctionLink></Implementation><Implementation Id="2" Name="FiP32" FriendlyName="32 Bit Fixed Point" Author="rkothbauer" Revision="1" DateCreated="2021-12-07" DateLastChange="2021-12-07" CFileName="TrackingLoop_FiP32.c" HFileName="TrackingLoop_FiP32.h" UpdateEnabled="true" ChecksumCFile="" ChecksumHFile="" AllowEmptyLoadFnc="false"><Description>32 Bit Fixed Point Implementation</Description><InportContainer><ImplementationInport Name="phi_eps" DataType="INT32"></ImplementationInport><ImplementationInport Name="n0" DataType="INT32"></ImplementationInport><ImplementationInport Name="phi0" DataType="INT32"></ImplementationInport><ImplementationInport Name="Enable" DataType="BOOL"></ImplementationInport></InportContainer><OutportContainer><ImplementationOutport Name="n" DataType="INT32"></ImplementationOutport><ImplementationOutport Name="phi" DataType="INT32"></ImplementationOutport></OutportContainer><ParameterContainer><ImplementationParameter Name="enable_old" DataType="BOOL" isLoadable="false" isSaveable="false" isArray="false" isFlashArray="false" arraySize="0"><Description>Enable value of previous cycle</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="i_old_torque" DataType="INT64" isLoadable="false" isSaveable="false" isArray="false" isFlashArray="false" arraySize="0"><Description>Torque integrator value from previous cycle</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="i_old_speed" DataType="INT64" isLoadable="false" isSaveable="false" isArray="false" isFlashArray="false" arraySize="0"><Description>Speed integrator value from previous cycle</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="i_old_angle" DataType="INT64" isLoadable="false" isSaveable="false" isArray="false" isFlashArray="false" arraySize="0"><Description>Angle integrator value from previous cycle</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="vGain" DataType="INT32" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Proportional gain value</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="sfrGain" DataType="INT8" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Shift factor of proportional gain</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="b0_torque" DataType="INT32" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Proportional coefficient PI</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="b1_torque" DataType="INT32" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Proportional coefficient PI</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="sfrb0_torque" DataType="INT8" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Shift factor for PI coefficient b0</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="sfrb1_torque" DataType="INT8" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Shift factor for PI coefficient b1</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="b0_speed" DataType="INT32" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Integral coefficient PI</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="b1_speed" DataType="INT32" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Proportional coefficient PI</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="sfrb0_speed" DataType="INT8" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Shift factor for PI coefficient b0</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="sfrb1_speed" DataType="INT8" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Shift factor for PI coefficient b1</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="b0_angle" DataType="INT32" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Integral coefficient PI</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="b1_angle" DataType="INT32" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Proportional coefficient PI</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="sfrb0_angle" DataType="INT8" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Shift factor for PI coefficient b0</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="sfrb1_angle" DataType="INT8" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Shift factor for PI coefficient b1</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="rawSpeed" DataType="BOOL" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>If true, the input to the angle integrator is the signal given to Speed output
If false, the output of the speed integrator is the signal given to Speed output</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter></ParameterContainer><Conversion Type="JavaScript" Language="JavaScript"></Conversion><FunctionLink Status="false" BlockName="" ImplementationName=""></FunctionLink></Implementation><Implementation Id="3" Name="Float32" FriendlyName="32 Bit Floating Point" Author="rkothbauer" Revision="1" DateCreated="2021-12-07" DateLastChange="2021-12-07" CFileName="TrackingLoop_Float32.c" HFileName="TrackingLoop_Float32.h" UpdateEnabled="true" ChecksumCFile="" ChecksumHFile="" AllowEmptyLoadFnc="false"><Description>32 Bit Floating Point Implementation</Description><InportContainer><ImplementationInport Name="phi_eps" DataType="FLOAT32"></ImplementationInport><ImplementationInport Name="n0" DataType="FLOAT32"></ImplementationInport><ImplementationInport Name="phi0" DataType="FLOAT32"></ImplementationInport><ImplementationInport Name="Enable" DataType="BOOL"></ImplementationInport></InportContainer><OutportContainer><ImplementationOutport Name="n" DataType="FLOAT32"></ImplementationOutport><ImplementationOutport Name="phi" DataType="FLOAT32"></ImplementationOutport></OutportContainer><ParameterContainer><ImplementationParameter Name="enable_old" DataType="BOOL" isLoadable="false" isSaveable="false" isArray="false" isFlashArray="false" arraySize="0"><Description>Enable value of previous cycle</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="i_old_torque" DataType="FLOAT32" isLoadable="false" isSaveable="false" isArray="false" isFlashArray="false" arraySize="0"><Description>Torque integrator value from previous cycle</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="i_old_speed" DataType="FLOAT32" isLoadable="false" isSaveable="false" isArray="false" isFlashArray="false" arraySize="0"><Description>Speed integrator value from previous cycle</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="i_old_angle" DataType="FLOAT32" isLoadable="false" isSaveable="false" isArray="false" isFlashArray="false" arraySize="0"><Description>Angle integrator value from previous cycle</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="vGain" DataType="FLOAT32" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Proportional gain value</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="b0_torque" DataType="FLOAT32" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Integral coefficient PI</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="b1_torque" DataType="FLOAT32" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Integral coefficient PI</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="b0_speed" DataType="FLOAT32" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Integral coefficient PI</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="b1_speed" DataType="FLOAT32" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Proportional coefficient PI</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="b0_angle" DataType="FLOAT32" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Integral coefficient PI</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="b1_angle" DataType="FLOAT32" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>Proportional coefficient P</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter><ImplementationParameter Name="rawSpeed" DataType="BOOL" isLoadable="true" isSaveable="true" isArray="false" isFlashArray="false" arraySize="0"><Description>If true, the input to the angle integrator is the signal given to Speed output
If false, the output of the speed integrator is the signal given to Speed output</Description><Value><Numeric>0.0</Numeric></Value></ImplementationParameter></ParameterContainer><Conversion Type="JavaScript" Language="JavaScript"></Conversion><FunctionLink Status="false" BlockName="" ImplementationName=""></FunctionLink></Implementation></ExistingImplementationContainer><UsedImplementation></UsedImplementation></ImplementationConfig></ControlBlock>